<!DOCTYPE html>
<html lang="en">


  <head>
    
    <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>RIDING BYTES</title>


<meta name="author" content="Ramon Bartl">
<meta name="description" content="RIDING BYTES UG (haftungsbeschränkt)">
<meta name="keywords" content="Bika,LIMS,Plone,Python,Consulting">
<meta name="google-site-verification" content="KWcX-TpnKFHyDQEIyT9i8oCI6kr2bHOml-vay9XLPe4" />



<link href="http://ridingbytes.com/de/vendor/bootstrap/css/bootstrap.min.css"                     rel="stylesheet" type="text/css" media="screen" />
<link href="http://ridingbytes.com/de/vendor/fontawesome/css/font-awesome.css"                    rel="stylesheet" type="text/css" media="screen" />
<link href="http://ridingbytes.com/de/vendor/novecento/css/novecento-font.css"                    rel="stylesheet" type="text/css" media="screen" />
<link href="http://ridingbytes.com/de/vendor/fancybox/css/jquery.fancybox.css?v=2.1.5"            rel="stylesheet" type="text/css" media="screen" />
<link href="http://ridingbytes.com/de/vendor/fancybox/css/jquery.fancybox-buttons.css?v=1.0.5"    rel="stylesheet" type="text/css" media="screen" />
<link href="http://ridingbytes.com/de/vendor/flexslider/css/flexslider.css"                       rel="stylesheet" type="text/css" media="screen" />
<link href="http://ridingbytes.com/de/vendor/rs-plugin/css/settings.css"                          rel="stylesheet" type="text/css" media="screen" />
<link href="http://ridingbytes.com/de/vendor/rs-plugin/css/extralayers.css"                       rel="stylesheet" type="text/css" media="screen" />
<link href="http://ridingbytes.com/de/vendor/feather/css/feather.css"                             rel="stylesheet" type="text/css" media="screen" />


<link href="http://ridingbytes.com/de/css/ridingbytes.css"                                        rel="stylesheet" type="text/css" media="screen" />



<script src="http://ridingbytes.com/de/vendor/jquery/js/jquery-1.10.1.min.js"                     type="text/javascript"></script>
<script src="http://ridingbytes.com/de/vendor/bootstrap/js/bootstrap.min.js"                      type="text/javascript"></script>
<script src="http://ridingbytes.com/de/vendor/sticky/js/jquery.sticky.js"                         type="text/javascript"></script>
<script src="http://ridingbytes.com/de/vendor/mousewheel/js/jquery.mousewheel-3.0.6.pack.js"      type="text/javascript"></script>
<script src="http://ridingbytes.com/de/vendor/fancybox/js/jquery.fancybox.pack.js?v=2.1.5"        type="text/javascript"></script>
<script src="http://ridingbytes.com/de/vendor/fancybox/js/jquery.fancybox-buttons.js?v=1.0.5"     type="text/javascript"></script>
<script src="http://ridingbytes.com/de/vendor/fancybox/js/jquery.fancybox-media.js?v=1.0.6"       type="text/javascript"></script>
<script src="http://ridingbytes.com/de/vendor/superfish/js/hoverIntent.js"                        type="text/javascript"></script>
<script src="http://ridingbytes.com/de/vendor/superfish/js/superfish.js"                          type="text/javascript"></script>
<script src="http://ridingbytes.com/de/vendor/superfish/js/supersubs.js"                          type="text/javascript"></script>
<script src="http://ridingbytes.com/de/vendor/flickr/js/jflickrfeed.min.js"                       type="text/javascript"></script>
<script src="http://ridingbytes.com/de/vendor/flexslider/js/jquery.flexslider-min.js"             type="text/javascript"></script>
<script src="http://ridingbytes.com/de/vendor/flickity/js/flickity.pkgd.min.js"                   type="text/javascript"></script>
<script src="http://ridingbytes.com/de/vendor/rs-plugin/js/jquery.themepunch.tools.min.js"        type="text/javascript"></script>
<script src="http://ridingbytes.com/de/vendor/rs-plugin/js/jquery.themepunch.revolution.min.js"   type="text/javascript"></script>
<script src="http://ridingbytes.com/de/vendor/stellar/js/jquery.stellar.min.js"                   type="text/javascript"></script>
<script src="http://ridingbytes.com/de/vendor/isotope/js/jquery.isotope.min.js"                   type="text/javascript"></script>
<script src="http://ridingbytes.com/de/vendor/imagesloaded/js/imagesloaded.pkgd.min.js"           type="text/javascript"></script>
<script src="http://ridingbytes.com/de/vendor/modernizr/js/modernizr.js"                          type="text/javascript"></script>
<script src="https://maps.google.com/maps/api/js?sensor=false"                              type="text/javascript"></script>

<script src="http://ridingbytes.com/de/js/jqBootstrapValidation.js"                               type="text/javascript"></script>
<script src="http://ridingbytes.com/de/js/script.js"                                              type="text/javascript"></script>
<script src="http://ridingbytes.com/de/js/ridingbytes.js"                                         type="text/javascript"></script>



<link href='http://fonts.googleapis.com/css?family=Oxygen:400,700' rel='stylesheet' type='text/css'>


    
  </head>

  <body class="template-default-page-listing">

    
    <div id="sub-top-light">
      <div class="container">
  <div class="top-items top-items-left">
    
    <div class="social-link"><a href="https://www.facebook.com/ridingbytes"><i class="fa fa-facebook"></i></a></div>
    
    <div class="social-link"><a href="https://github.com/ridingbytes"><i class="fa fa-github"></i></a></div>
    
    <div class="social-link"><a href="https://www.linkedin.com/company/riding-bytes"><i class="fa fa-linkedin"></i></a></div>
    
    <div class="social-link"><a href="https://twitter.com/ridingbytes"><i class="fa fa-twitter"></i></a></div>
    
  </div>
  <div class="top-items top-items-right">
    <div id="language-links">
      <i class="fa fa-globe"></i>
      <a href="/" alt="en" title="English">English</a> / <a href="/de" alt="de" title="Deutsch">Deutsch</a>
    </div>
  </div>
</div>

    </div>
    

    
    <header id="header-wrapper-mp" class="sticky-menu-light default-page-listing">

      <div class="sticky-header header-light" role="navigation">
        <div class="container mp-nav">

          
          <div id="site-title">
  <h1 class="font-accident-one-bold">
    <a href="http://ridingbytes.com/de/">
      
        RIDING BYTES
      
    </a>
  </h1>
</div>

          

          
          
<div id="mobnav-btn"><i class="fa fa-bars"></i></div>
<nav id="main-menu" class="site-navigation primary-navigation" role="navigation">
  <ul class="sf-menu clearfix" id="example">
     
     <li>
       <a href="/de/">Startseite</a>
       
     </li>
     
     <li>
       <a href="/de/services">Dienstleistungen</a>
       
       <div class="mobnav-subarrow"></div>
       <ul class="submenu">
           
           <li><a href="/de/services/#development" class="page-scroll">Development</a></li>
           
           <li><a href="/de/services/#uiux" class="page-scroll">UI/UX</a></li>
           
           <li><a href="/de/services/#consulting" class="page-scroll">Consulting</a></li>
           
           <li><a href="/de/services/#administration" class="page-scroll">Administration</a></li>
           
       </ul>
       
     </li>
     
     <li>
       <a href="/de/portfolio">Portfolio</a>
       
     </li>
     
     <li>
       <a href="/de/blog">Blog</a>
       
     </li>
     
     <li>
       <a href="/de/about">Über uns</a>
       
     </li>
     
     <li>
       <a href="/de/contact">Kontakt</a>
       
     </li>
     
  </ul>
</nav>


          

        </div>
      </div>

      
      <div class="container">
  <div id="page-title">
    <div class="page-title-details">
      <h1 class="font-accident-one fontcolor-invert">Odoo</h1>
      <h4 class="font-accident-one-light fontcolor-invert"></h4>
      
    </div>
  </div>
</div>

      

    </header>
    

    
    <div id="content">

      
      <div class="down-arrow">&nbsp;</div>
      

      
      <div class="container">
        <div class="row">
          <div id="odoo: developer mode">
            
            <div class="col-md-12">
              

<h1 id="odoo-access-technical-features">Odoo: Access Technical Features</h1>

<p>In Odoo 9 you might miss the <code>Technical Features</code> checkbox in the <em>Access
Rights</em> of your user. These settings are now visible if you activate the
<strong>Developer Mode</strong> from the <strong>About</strong> menu.</p>

<p>I had to access this many times during development and found out, that I lose
too much time accessing the menu and clicking on the button. I had to change
this!</p>

<p>I created this small <a href="#bookmarklet">Bookmarklet</a>,
which toggles the developer mode by a single click&hellip;</p>


<figure class="image-center">
    
        <img src="/media/blog/odoo-about.png" />
    
    
</figure>


<h2 id="bookmarklet">Odoo Developer Bookmarklet</h2>

<p>Drag&amp;Drop this Button to your Bookmarks Bar to toggle Odoo Developer Mode:</p>

<p><a class="btn btn-success" href="javascript:(function(){
  var url=location.href.split(location.hash)[0];
  if(!url.endsWith('?debug')){
    location.href=url+'?debug'+location.hash;
  }else{
    if (confirm('Already in developer Mode. Do you want to Leave?')){
      url=url.split('?debug')[0];
      location.href=url+location.hash;
    }
  }})()">
  Toggle Odoo Dev-Mode
</a></p>


<figure class="image-left">
    
        <img src="/media/blog/odoo-dev-mode-toggle.png" />
    
    
</figure>


<div class="container rb-divider">
  <div class="row">
    <div class="dividewhite2"></div>
    <div class="e-block-centered">
      &mdash; <img src="/img/rb_logo_32x32.png" /> &mdash;
    </div>
    <div class="dividewhite2"></div>
  </div>
</div>


            </div>
          </div>
        </div>
      </div>
      
      <div class="container">
        <div class="row">
          <div id="odoo: dynamic image resizing">
            
            <div class="col-md-12">
              

<h1 id="odoo-scale-images-on-the-fly">Odoo: Scale images on the fly</h1>

<p>Odoo uses Python Imaging Library (PIL) to support image resizing on the fly.
This functionality ships with the <code>image.py</code> module, which is located in
<code>openerp.tools.image</code>.</p>

<h2 id="problem">Problem</h2>

<p>I implemented a custom model which defined a binary field called <code>image</code>:</p>


class MyModel(models.Model):
    _name = 'my.model'

    image = fields.Binary('Image', required=True)
    image_filename = fields.Char("Image Filename")


<p>I wanted to use this model within in a website view, but struggled with finding
a suitable image source URL for the image field. Unfortunately it was only
possible to access the <code>base64</code> encoded image data.</p>

<p>Thus, I ended up using the inline data option within the <code>src</code> attribute of the
image tag:</p>


<img t-attf-src="data:image/jpg;base64,{{ my.model.image }}" />


<p>This actually worked quite well, but using the raw <code>base64</code> data within the
HTML feels kind of awkward to me and it also uses the full image size, which
was not suitable for me.</p>

<h2 id="solution">Solution</h2>

<p>Odoo&rsquo;s <code>website</code> addon ships with a controller, which allows to access image
fields of any model through an URL. This controller is located in
<code>odoo/addons/website/controllers/main.py</code> and offers this route:</p>


@http.route([
    '/website/image',
    '/website/image/<model>/<id>/<field>',
    '/website/image/<model>/<id>/<field>/<int:max_width>x<int:max_height>'
    ], auth="public", website=True, multilang=False)
def website_image(self, model, id, field, max_width=None, max_height=None):
    """ Fetches the requested field and ensures it does not go above
    (max_width, max_height), resizing it if necessary.

    If the record is not found or does not have the requested field,
    returns a placeholder image via :meth:`~.placeholder`.

    Sets and checks conditional response parameters:
    * :mailheader:`ETag` is always set (and checked)
    * :mailheader:`Last-Modified is set iif the record has a concurrency
      field (``__last_update``)

    The requested field is assumed to be base64-encoded image data in
    all cases.
    """


<p>With this route, I could change my inline rendered image to use this URL and do
the resizing as well:</p>


<img t-attf-src="/website/image/my.model/{{ my.model.id }}/image/128x128" />


<h2 id="going-further">Going further</h2>

<p>As I could use this nice URL to access the image of my custom model, I thought
about using an attribute on the model to provide the scaled image directly.
Therefore I changed the code of my model and added the fields <code>image_medium</code>
and <code>image_small</code>:</p>


class MyModel(models.Model):
    _name = 'my.model'

    image = fields.Binary('Image', required=True)
    image_filename = fields.Char("Image Filename")

    # Scaled Images
    image_medium = fields.Binary(string="Medium-sized image",
                                 store=False,
                                 compute="_get_image",
                                 help="Medium-sized image of this model. It is automatically " \
                                      "resized as a 128x128px image, with aspect ratio preserved. " \
                                      "Use this field in form views or some kanban views.")

    image_small = fields.Binary(string="Small-sized image",
                                store=False,
                                compute="_get_image",
                                help="Small sized image of this model. It is automatically " \
                                     "resized as a 64x64px image, with aspect ratio preserved. " \
                                     "Use this field in form views or some kanban views.")




<figure class="image-left">
    
        <img src="/media/blog/odoo-dynamic-image-resizing.png" class="img-responsive"  />
    
    
</figure>



<p>I also wanted to prevent that the images get stored in the database, to avoid
unnecessary data growth. Therefore I used a computed field
(<code>compute=&quot;_get_image&quot;</code>) and passed in the <code>store=False</code> option.</p>

<p>My first shot of the <code>_get_image</code> method looked like this:</p>


class MyModel(models.Model):
    _name = 'my.model'

    [...]

    @api.one
    @api.depends("image")
    def _get_image(self):
        """ calculate the images sizes and set the images to the corresponding
            fields
        """
        image = self.image

        data = tools.image_get_resized_images(image)
        self.image_medium = data["image_medium"]
        self.image_small = data["image_small"]
        return True



<p>I was unlucky again, since this code worked exactly once, and that was when the
<code>image</code> field was initially set.</p>

<p>The problem was, that after the <code>image</code> field was set, a <code>context</code> variable
with the name <code>bin_size</code> and the value <code>True</code> was set, which instructed the
image field to return only the image size instead of the full <code>base64</code> encoded
image. The complete <code>context</code> I inspected within this method looked like this:</p>


ipdb> self.env.context
{'lang': 'en_US', 'bin_size': True, 'tz': 'Europe/Berlin', 'uid': 1}


<p>I found the corresponding field definition for the binary field in <code>openerp.osv.fields</code>:</p>


class binary(_column):
    _type = 'binary'
    [...]
    def get(self, cr, obj, ids, name, user=None, context=None, values=None):
        [...]

        # If client is requesting only the size of the field, we return it instead
        # of the content. Presumably a separate request will be done to read the actual
        # content if it's needed at some point.
        # TODO: after 6.0 we should consider returning a dict with size and content instead of
        #       having an implicit convention for the value
        if val and context.get('bin_size_%s' % name, context.get('bin_size')):
            res[i] = tools.human_size(long(val))
        [...]


<p>After some research I figured out that it is possible to overwrite this
immutable <code>context</code> with the method <code>with_context</code> on the model itself.</p>

<p><a href="http://odoo-new-api-guide-line.readthedocs.org/en/latest/environment.html#modifing-environment">http://odoo-new-api-guide-line.readthedocs.org/en/latest/environment.html#modifing-environment</a></p>

<p>So the final version of my <code>_get_image</code> method looked like this:</p>


class MyModel(models.Model):
    _name = 'my.model'

    [...]

    @api.one
    @api.depends("image")
    def _get_image(self):
        """ calculate the images sizes and set the images to the corresponding
            fields
        """
        image = self.image

        # check if the context contains the magic `bin_size` key
        if self.env.context.get("bin_size"):
            # refetch the image with a clean context
            image = self.env[self._name].with_context({}).browse(self.id).image

        data = tools.image_get_resized_images(image)
        self.image_medium = data["image_medium"]
        self.image_small = data["image_small"]
        return True



<p>Now it was possible to access the computed fields directly with the URL of the
<code>website</code> controller:</p>


<img t-attf-src="/website/image/my.model/{{ my.model.id }}/image_small" />


<p>Or simply by the URL itself:</p>

<p><a href="http://localhost:8069/website/image/my.model/1/image_medium">http://localhost:8069/website/image/my.model/1/image_medium</a></p>

<h2 id="conclusion">Conclusion</h2>

<p>The size calculation of the images takes some time and this should be
considered with regard to the servers performance. So I guess it makes
more sense to actually store the image scales in the database to avoid
this workaround described above.</p>

<p>I also think that the workaround bypasses security, since it removes the <code>uid</code>
from the context as well. But I didn&rsquo;t investigate it any further.</p>

<p>The whole excursion was more or less driven by curiosity, since I only found
instructions in the internet on how to do this using the old Odoo V7 API.</p>

<p>The closest tutorial I found was this here:</p>

<p><a href="http://www.odoo.yenthevg.com/saving-and-resizing-images-in-odoo-8">http://www.odoo.yenthevg.com/saving-and-resizing-images-in-odoo-8</a></p>

<p>So I hope this is useful for someone:)</p>

<div class="container rb-divider">
  <div class="row">
    <div class="dividewhite2"></div>
    <div class="e-block-centered">
      &mdash; <img src="/img/rb_logo_32x32.png" /> &mdash;
    </div>
    <div class="dividewhite2"></div>
  </div>
</div>


            </div>
          </div>
        </div>
      </div>
      
      <div class="container">
        <div class="row">
          <div id="odoo: remember the filename of binary files">
            
            <div class="col-md-12">
              <h1 id="odoo-remember-the-filename-of-binary-files">Odoo: Remember the filename of binary files</h1>

<h2 id="problem">Problem</h2>

<p>I wanted to use a binary field to store image data to a custom model.
Therefore I used a field of the type <code>Binary</code> in my model. Unfortunately only
the base64 encoded file was stored in the database but not the filename. This
resulted in an unknown binary file download with the name of the current model.</p>

<p></p>

<h2 id="solution">Solution</h2>

<p>Luckily I found a solution for this problem. First, I added another field to my
model to store the filename. The name of this field can be arbitrary.
The next step was to tell the image widget to use this field to store the filename:
<code>&lt;field widget=&quot;binary&quot; height=&quot;64&quot; name=&quot;image&quot; filename=&quot;image_filename&quot; /&gt;</code>.</p>

<p>Below is the full code listing to make it work:</p>

<h3 id="python-code">Python Code</h3>


class MyModel(models.Model):
    _name = 'my.model'

    image = fields.Binary('Image', required=True)
    image_filename = fields.Char("Image Filename")


<h3 id="xml-view">XML View</h3>


<record id="view_form_my_model" model="ir.ui.view">
  <field name="name">My Model Form</field>
  <field name="model">my.model</field>
  <field name="arch" type="xml">
    <form>
      <sheet>
        <group name="group_top">
          <group name="group_left">
            <field name="image_filename" invisible="0"/>
            <field widget="binary" height="64" name="image" filename="image_filename" />
          </group>
          <group name="group_right">
          </group>
        </group>
      </sheet>
    </form>
  </field>
</record>


<h2 id="result">Result</h2>

<p>The download works now like a charm and it is even possible to modify the
filename directly.</p>


<figure class="image-left">
    
        <img src="/media/blog/odoo-filename-handling.png" class="img-responsive"  />
    
    
</figure>



<div class="container rb-divider">
  <div class="row">
    <div class="dividewhite2"></div>
    <div class="e-block-centered">
      &mdash; <img src="/img/rb_logo_32x32.png" /> &mdash;
    </div>
    <div class="dividewhite2"></div>
  </div>
</div>
            </div>
          </div>
        </div>
      </div>
      

    </div>
  

    
    <a class="gm-toggle-link">
      <div class="gm-toggle">
          <i class="fa fa-map-marker"></i>
      </div>
    </a>
    <div id="gm-panel">
        <div id="google-map" class="bigmap"></div>
    </div>
    

    
    <div id="footer">
      
      <div class="container">

  <div class="row">

    
    <div class="col-sm-3">
      
<div class="infoblock">
  <h2 class="font-accident-one-bold">RIDING BYTES</h2>

  
  <p class=" ">RIDING BYTES ist spezialisiert auf professionelle Open Source Systeme und bietet passende Unternehmenslösungen, z.B. für das Inhalte- und Datenmanagement, sowie spezialisierte Lösungen für den Gesundheits- und Laborbereich.</p>
  
  <p class=" ">Mit über 10 Jahren Erfahrung im professionellen Open Source Bereich, sind wir Partner für kleine, mittlere und große Unternehmen und unterstützen die Integration professioneller Open Source IT Lösungen.</p>
  

</div>


    </div>

    
    <div class="col-sm-3">
      
<div class="infoblock">
  <h2 class="font-accident-one-bold">Kontakt</h2>

  
  <div class="contact">

    
    
    <div class="footer-addr">
      <div class="footer-icon"><i class="fa fa-home"></i></div>
      <div class="addr-text">RIDING BYTES UG (haftungsbeschränkt), Würzburger Straße 81, 90766 Fürth, Deutschland</div>
    </div>
    

    
    
    <div class="dividewhite1"></div>
    <div class="footer-addr">
      <div class="footer-icon"><i class="fa fa-phone"></i></div>
      <div class="addr-text"><a href="tel:&#43;49%20%280%29%20911%20974%20930%2090">&#43;49 (0) 911 974 930 90</a></div>
    </div>
    

    
    
    <div class="dividewhite1"></div>
    <div class="footer-addr">
      <div class="footer-icon"><i class="fa fa-link"></i></div>
      <div class="addr-text"><a href="http://ridingbytes.com">http://ridingbytes.com</a></div>
    </div>
    

    
    
    <div class="dividewhite1"></div>
    <div class="footer-addr">
      <div class="footer-icon"><i class="fa fa-envelope"></i></div>
      <div class="addr-text"><a href="mailto:hello@ridingbytes.com">hello@ridingbytes.com</a></div>
    </div>
    

  </div>
  

</div>


    </div>
    

    
    <div class="col-sm-3">
      
  <div class="infoblock">
    <h2 class="font-accident-one-bold">Impressionen</h2>
    <ul id="basicuse" class="thumbs"></ul>
  </div>


    </div>
    

    
    <div class="col-sm-3">
      
<div class="infoblock">

  <h2 class="font-accident-one-bold"> Folgen Sie uns </h2>
  <div class="follow">

    
    <div class="follow-element">
      <div class="follow-icon"><i class="fa fa-facebook"></i></div>
      <div class="follow-descr">
        <div class="follow-social"><a href="https://www.facebook.com/ridingbytes">Facebook</a></div>
      </div>
    </div>
    <div class="dividewhite1"></div>
    
    <div class="follow-element">
      <div class="follow-icon"><i class="fa fa-github"></i></div>
      <div class="follow-descr">
        <div class="follow-social"><a href="https://github.com/ridingbytes">GitHub</a></div>
      </div>
    </div>
    <div class="dividewhite1"></div>
    
    <div class="follow-element">
      <div class="follow-icon"><i class="fa fa-linkedin"></i></div>
      <div class="follow-descr">
        <div class="follow-social"><a href="https://www.linkedin.com/company/riding-bytes">LinkedIn</a></div>
      </div>
    </div>
    <div class="dividewhite1"></div>
    
    <div class="follow-element">
      <div class="follow-icon"><i class="fa fa-twitter"></i></div>
      <div class="follow-descr">
        <div class="follow-social"><a href="https://twitter.com/ridingbytes">Twitter</a></div>
      </div>
    </div>
    <div class="dividewhite1"></div>
    

  </div>
</div>


    </div>
    

  </div>
</div>




<img src="https://piwik.ridingbytes.com/piwik.php?idsite=1&rec=1" style="border:0" alt="Piwik" />






      
      
<div id="copyrights-wrapper">
  <div class="container">
    <div class="copyright">
      <div class="copy-attrs">
        &copy; 2015 - 
        <a href="/" target="_blank">RIDING BYTES</a>. Alle Rechte vorbehalten
      </div>

      
      <div class="copy-link">
        <a href="/legal">Impressum</a>
      </div>
      

    </div>
  </div>
</div>


    </div>
    

    
    <div id="back-top"><a href="#top"></a></div>
    

  </body>
</html>
