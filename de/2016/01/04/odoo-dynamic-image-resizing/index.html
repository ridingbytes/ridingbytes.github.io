<!DOCTYPE html>
<html lang="en">


  <head>
    
    <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>RIDING BYTES</title>


<meta name="author" content="Ramon Bartl">
<meta name="description" content="Riding Bytes UG (haftungsbeschränkt)">
<meta name="keywords" content="Python,Plone,Zope,JavaScript,CoffeeScript,Web,Development,Consulting">
<meta name="google-site-verification" content="KWcX-TpnKFHyDQEIyT9i8oCI6kr2bHOml-vay9XLPe4" />



<link href="http://ridingbytes.com/devendor/bootstrap/css/bootstrap.min.css"                     rel="stylesheet" type="text/css" media="screen" />
<link href="http://ridingbytes.com/devendor/fontawesome/css/font-awesome.css"                    rel="stylesheet" type="text/css" media="screen" />
<link href="http://ridingbytes.com/devendor/novecento/css/novecento-font.css"                    rel="stylesheet" type="text/css" media="screen" />
<link href="http://ridingbytes.com/devendor/fancybox/css/jquery.fancybox.css?v=2.1.5"            rel="stylesheet" type="text/css" media="screen" />
<link href="http://ridingbytes.com/devendor/fancybox/css/jquery.fancybox-buttons.css?v=1.0.5"    rel="stylesheet" type="text/css" media="screen" />
<link href="http://ridingbytes.com/devendor/flexslider/css/flexslider.css"                       rel="stylesheet" type="text/css" media="screen" />
<link href="http://ridingbytes.com/devendor/rs-plugin/css/settings.css"                          rel="stylesheet" type="text/css" media="screen" />
<link href="http://ridingbytes.com/devendor/rs-plugin/css/extralayers.css"                       rel="stylesheet" type="text/css" media="screen" />
<link href="http://ridingbytes.com/devendor/feather/css/feather.css"                             rel="stylesheet" type="text/css" media="screen" />


<link href="http://ridingbytes.com/decss/ridingbytes.css"                                              rel="stylesheet" type="text/css" media="screen" />



<script src="http://ridingbytes.com/devendor/jquery/js/jquery-1.10.1.min.js"                     type="text/javascript"></script>
<script src="http://ridingbytes.com/devendor/bootstrap/js/bootstrap.min.js"                      type="text/javascript"></script>
<script src="http://ridingbytes.com/devendor/sticky/js/jquery.sticky.js"                         type="text/javascript"></script>
<script src="http://ridingbytes.com/devendor/mousewheel/js/jquery.mousewheel-3.0.6.pack.js"      type="text/javascript"></script>
<script src="http://ridingbytes.com/devendor/fancybox/js/jquery.fancybox.pack.js?v=2.1.5"        type="text/javascript"></script>
<script src="http://ridingbytes.com/devendor/fancybox/js/jquery.fancybox-buttons.js?v=1.0.5"     type="text/javascript"></script>
<script src="http://ridingbytes.com/devendor/fancybox/js/jquery.fancybox-media.js?v=1.0.6"       type="text/javascript"></script>
<script src="http://ridingbytes.com/devendor/superfish/js/hoverIntent.js"                        type="text/javascript"></script>
<script src="http://ridingbytes.com/devendor/superfish/js/superfish.js"                          type="text/javascript"></script>
<script src="http://ridingbytes.com/devendor/superfish/js/supersubs.js"                          type="text/javascript"></script>
<script src="http://ridingbytes.com/devendor/flickr/js/jflickrfeed.min.js"                       type="text/javascript"></script>
<script src="http://ridingbytes.com/devendor/flexslider/js/jquery.flexslider-min.js"             type="text/javascript"></script>
<script src="http://ridingbytes.com/devendor/flickity/js/flickity.pkgd.min.js"                   type="text/javascript"></script>
<script src="http://ridingbytes.com/devendor/rs-plugin/js/jquery.themepunch.tools.min.js"        type="text/javascript"></script>
<script src="http://ridingbytes.com/devendor/rs-plugin/js/jquery.themepunch.revolution.min.js"   type="text/javascript"></script>
<script src="http://ridingbytes.com/devendor/stellar/js/jquery.stellar.min.js"                   type="text/javascript"></script>
<script src="http://ridingbytes.com/devendor/isotope/js/jquery.isotope.min.js"                   type="text/javascript"></script>
<script src="http://ridingbytes.com/devendor/imagesloaded/js/imagesloaded.pkgd.min.js"           type="text/javascript"></script>
<script src="http://ridingbytes.com/devendor/modernizr/js/modernizr.js"                          type="text/javascript"></script>
<script src="https://maps.google.com/maps/api/js?sensor=false"                             type="text/javascript"></script>

<script src="http://ridingbytes.com/dejs/jqBootstrapValidation.js"                               type="text/javascript"></script>
<script src="http://ridingbytes.com/dejs/script.js"                                              type="text/javascript"></script>
<script src="http://ridingbytes.com/dejs/ridingbytes.js"                                         type="text/javascript"></script>



<link href='http://fonts.googleapis.com/css?family=Oxygen:400,700' rel='stylesheet' type='text/css'>






    
  </head>

  <body class="template-blog-page-single">

    
    <div id="sub-top-light">
      <div class="container">
        <div class="top-contacts">
          
<div class="social-link"><a href="https://www.facebook.com/ridingbytes"><i class="fa fa-facebook"></i></a></div>

<div class="social-link"><a href="https://github.com/ridingbytes"><i class="fa fa-github"></i></a></div>

<div class="social-link"><a href="https://www.linkedin.com/company/riding-bytes"><i class="fa fa-linkedin"></i></a></div>

<div class="social-link"><a href="https://twitter.com/ridingbytes"><i class="fa fa-twitter"></i></a></div>


        </div>
      </div>
     </div>
    

    
    <header id="header-wrapper-mp" class="sticky-menu-light blog-page-single">

      <div class="sticky-header header-light" role="navigation">
        <div class="container mp-nav">

          
          
<div id="site-title">
  <h1 class="font-accident-one-bold">
    <a href="/">
      
        Riding Bytes
      
    </a>
  </h1>
</div>


          

          
          <div id="mobnav-btn"><i class="fa fa-bars"></i></div>
<nav id="main-menu" class="site-navigation primary-navigation" role="navigation">
  <ul class="sf-menu clearfix" id="example">
     
     <li>
       <a href="/">Start</a>
       
       <div class="mobnav-subarrow"></div>
       <ul class="submenu">
           
           <li><a href="/#services" class="page-scroll">Services</a></li>
           
           <li><a href="/#pricing" class="page-scroll">Service Packages</a></li>
           
           <li><a href="/#customers" class="page-scroll">Customers</a></li>
           
       </ul>
       
     </li>
     
     <li>
       <a href="/services">Dienstleistungen</a>
       
       <div class="mobnav-subarrow"></div>
       <ul class="submenu">
           
           <li><a href="/services/#development" class="page-scroll">Development</a></li>
           
           <li><a href="/services/#uiux" class="page-scroll">UI/UX</a></li>
           
           <li><a href="/services/#consulting" class="page-scroll">Consulting</a></li>
           
           <li><a href="/services/#administration" class="page-scroll">Administration</a></li>
           
       </ul>
       
     </li>
     
     <li>
       <a href="/portfolio">Portfolio</a>
       
     </li>
     
     <li>
       <a href="/blog">Blog</a>
       
     </li>
     
     <li>
       <a href="/about">Über</a>
       
     </li>
     
     <li>
       <a href="/contact">Kontakt</a>
       
     </li>
     
  </ul>
</nav>

          

        </div>
      </div>

      
      <div class="container">
  <div id="page-title">
    <div class="page-title-details">
      <h1 class="font-accident-one fontcolor-invert">Odoo: Dynamic image resizing</h1>
      <h4 class="font-accident-one-light fontcolor-invert"></h4>
      <ul>
        
        <li><a href="/">Home</a>&nbsp;&nbsp;&nbsp;/</li>
        <li><a href="/blog">Blog</a>&nbsp;&nbsp;&nbsp;/</li>
        
        <li>Odoo: Dynamic image resizing</li>
      </ul>
    </div>
  </div>
</div>

      

    </header>
    

    
    <div id="content">

      
      

      
      <div class="down-arrow">&nbsp;</div>
      

      <div class="container">
        <div class="row">
          
          <div class="col-md-12 post-content">
            

<h1 id="odoo-scale-images-on-the-fly">Odoo: Scale images on the fly</h1>

<p>Odoo uses Python Imaging Library (PIL) to support image resizing on the fly.
This functionality ships with the <code>image.py</code> module, which is located in
<code>openerp.tools.image</code>.</p>

<h2 id="problem">Problem</h2>

<p>I implemented a custom model which defined a binary field called <code>image</code>:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">class</span> <span style="color: #a6e22e">MyModel</span><span style="color: #f8f8f2">(models</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Model):</span>
    <span style="color: #f8f8f2">_name</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;my.model&#39;</span>

    <span style="color: #f8f8f2">image</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">fields</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Binary(</span><span style="color: #e6db74">&#39;Image&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">required</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">True)</span>
    <span style="color: #f8f8f2">image_filename</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">fields</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Char(</span><span style="color: #e6db74">&quot;Image Filename&quot;</span><span style="color: #f8f8f2">)</span>
</pre></div>


<p>I wanted to use this model within in a website view, but struggled with finding
a suitable image source URL for the image field. Unfortunately it was only
possible to access the <code>base64</code> encoded image data.</p>

<p>Thus, I ended up using the inline data option within the <code>src</code> attribute of the
image tag:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">&lt;</span><span style="color: #f92672">img</span> <span style="color: #a6e22e">t-attf-src</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;data:image/jpg;base64,{{ my.model.image }}&quot;</span> <span style="color: #f8f8f2">/&gt;</span>
</pre></div>


<p>This actually worked quite well, but using the raw <code>base64</code> data within the
HTML feels kind of awkward to me and it also uses the full image size, which
was not suitable for me.</p>

<h2 id="solution">Solution</h2>

<p>Odoo&rsquo;s <code>website</code> addon ships with a controller, which allows to access image
fields of any model through an URL. This controller is located in
<code>odoo/addons/website/controllers/main.py</code> and offers this route:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #a6e22e">@http.route</span><span style="color: #f8f8f2">([</span>
    <span style="color: #e6db74">&#39;/website/image&#39;</span><span style="color: #f8f8f2">,</span>
    <span style="color: #e6db74">&#39;/website/image/&lt;model&gt;/&lt;id&gt;/&lt;field&gt;&#39;</span><span style="color: #f8f8f2">,</span>
    <span style="color: #e6db74">&#39;/website/image/&lt;model&gt;/&lt;id&gt;/&lt;field&gt;/&lt;int:max_width&gt;x&lt;int:max_height&gt;&#39;</span>
    <span style="color: #f8f8f2">],</span> <span style="color: #f8f8f2">auth</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;public&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">website</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">True,</span> <span style="color: #f8f8f2">multilang</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">False)</span>
<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">website_image</span><span style="color: #f8f8f2">(self,</span> <span style="color: #f8f8f2">model,</span> <span style="color: #f8f8f2">id,</span> <span style="color: #f8f8f2">field,</span> <span style="color: #f8f8f2">max_width</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">None,</span> <span style="color: #f8f8f2">max_height</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">None):</span>
    <span style="color: #e6db74">&quot;&quot;&quot; Fetches the requested field and ensures it does not go above</span>
<span style="color: #e6db74">    (max_width, max_height), resizing it if necessary.</span>

<span style="color: #e6db74">    If the record is not found or does not have the requested field,</span>
<span style="color: #e6db74">    returns a placeholder image via :meth:`~.placeholder`.</span>

<span style="color: #e6db74">    Sets and checks conditional response parameters:</span>
<span style="color: #e6db74">    * :mailheader:`ETag` is always set (and checked)</span>
<span style="color: #e6db74">    * :mailheader:`Last-Modified is set iif the record has a concurrency</span>
<span style="color: #e6db74">      field (``__last_update``)</span>

<span style="color: #e6db74">    The requested field is assumed to be base64-encoded image data in</span>
<span style="color: #e6db74">    all cases.</span>
<span style="color: #e6db74">    &quot;&quot;&quot;</span>
</pre></div>


<p>With this route, I could change my inline rendered image to use this URL and do
the resizing as well:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">&lt;</span><span style="color: #f92672">img</span> <span style="color: #a6e22e">t-attf-src</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;/website/image/my.model/{{ my.model.id }}/image/128x128&quot;</span> <span style="color: #f8f8f2">/&gt;</span>
</pre></div>


<h2 id="going-further">Going further</h2>

<p>As I could use this nice URL to access the image of my custom model, I thought
about using an attribute on the model to provide the scaled image directly.
Therefore I changed the code of my model and added the fields <code>image_medium</code>
and <code>image_small</code>:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">class</span> <span style="color: #a6e22e">MyModel</span><span style="color: #f8f8f2">(models</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Model):</span>
    <span style="color: #f8f8f2">_name</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;my.model&#39;</span>

    <span style="color: #f8f8f2">image</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">fields</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Binary(</span><span style="color: #e6db74">&#39;Image&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">required</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">True)</span>
    <span style="color: #f8f8f2">image_filename</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">fields</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Char(</span><span style="color: #e6db74">&quot;Image Filename&quot;</span><span style="color: #f8f8f2">)</span>

    <span style="color: #75715e"># Scaled Images</span>
    <span style="color: #f8f8f2">image_medium</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">fields</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Binary(string</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;Medium-sized image&quot;</span><span style="color: #f8f8f2">,</span>
                                 <span style="color: #f8f8f2">store</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">False,</span>
                                 <span style="color: #f8f8f2">compute</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;_get_image&quot;</span><span style="color: #f8f8f2">,</span>
                                 <span style="color: #f8f8f2">help</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;Medium-sized image of this model. It is automatically &quot;</span> \
                                      <span style="color: #e6db74">&quot;resized as a 128x128px image, with aspect ratio preserved. &quot;</span> \
                                      <span style="color: #e6db74">&quot;Use this field in form views or some kanban views.&quot;</span><span style="color: #f8f8f2">)</span>

    <span style="color: #f8f8f2">image_small</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">fields</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Binary(string</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;Small-sized image&quot;</span><span style="color: #f8f8f2">,</span>
                                <span style="color: #f8f8f2">store</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">False,</span>
                                <span style="color: #f8f8f2">compute</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;_get_image&quot;</span><span style="color: #f8f8f2">,</span>
                                <span style="color: #f8f8f2">help</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;Small sized image of this model. It is automatically &quot;</span> \
                                     <span style="color: #e6db74">&quot;resized as a 64x64px image, with aspect ratio preserved. &quot;</span> \
                                     <span style="color: #e6db74">&quot;Use this field in form views or some kanban views.&quot;</span><span style="color: #f8f8f2">)</span>
</pre></div>



<figure class="image-left">
    
        <img src="/media/blog/odoo-dynamic-image-resizing.png" class="img-responsive"  />
    
    
</figure>



<p>I also wanted to prevent that the images get stored in the database, to avoid
unnecessary data growth. Therefore I used a computed field
(<code>compute=&quot;_get_image&quot;</code>) and passed in the <code>store=False</code> option.</p>

<p>My first shot of the <code>_get_image</code> method looked like this:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">class</span> <span style="color: #a6e22e">MyModel</span><span style="color: #f8f8f2">(models</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Model):</span>
    <span style="color: #f8f8f2">_name</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;my.model&#39;</span>

    <span style="color: #f8f8f2">[</span><span style="color: #f92672">...</span><span style="color: #f8f8f2">]</span>

    <span style="color: #a6e22e">@api.one</span>
    <span style="color: #a6e22e">@api.depends</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;image&quot;</span><span style="color: #f8f8f2">)</span>
    <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">_get_image</span><span style="color: #f8f8f2">(self):</span>
        <span style="color: #e6db74">&quot;&quot;&quot; calculate the images sizes and set the images to the corresponding</span>
<span style="color: #e6db74">            fields</span>
<span style="color: #e6db74">        &quot;&quot;&quot;</span>
        <span style="color: #f8f8f2">image</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">image</span>

        <span style="color: #f8f8f2">data</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">tools</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">image_get_resized_images(image)</span>
        <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">image_medium</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">data[</span><span style="color: #e6db74">&quot;image_medium&quot;</span><span style="color: #f8f8f2">]</span>
        <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">image_small</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">data[</span><span style="color: #e6db74">&quot;image_small&quot;</span><span style="color: #f8f8f2">]</span>
        <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">True</span>
</pre></div>


<p>I was unlucky again, since this code worked exactly once, and that was when the
<code>image</code> field was initially set.</p>

<p>The problem was, that after the <code>image</code> field was set, a <code>context</code> variable
with the name <code>bin_size</code> and the value <code>True</code> was set, which instructed the
image field to return only the image size instead of the full <code>base64</code> encoded
image. The complete <code>context</code> I inspected within this method looked like this:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">ipdb</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">env</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">context</span>
<span style="color: #f8f8f2">{</span><span style="color: #e6db74">&#39;lang&#39;</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&#39;en_US&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&#39;bin_size&#39;</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">True,</span> <span style="color: #e6db74">&#39;tz&#39;</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&#39;Europe/Berlin&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&#39;uid&#39;</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2">}</span>
</pre></div>


<p>I found the corresponding field definition for the binary field in <code>openerp.osv.fields</code>:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">class</span> <span style="color: #a6e22e">binary</span><span style="color: #f8f8f2">(_column):</span>
    <span style="color: #f8f8f2">_type</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;binary&#39;</span>
    <span style="color: #f8f8f2">[</span><span style="color: #f92672">...</span><span style="color: #f8f8f2">]</span>
    <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">get</span><span style="color: #f8f8f2">(self,</span> <span style="color: #f8f8f2">cr,</span> <span style="color: #f8f8f2">obj,</span> <span style="color: #f8f8f2">ids,</span> <span style="color: #f8f8f2">name,</span> <span style="color: #f8f8f2">user</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">None,</span> <span style="color: #f8f8f2">context</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">None,</span> <span style="color: #f8f8f2">values</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">None):</span>
        <span style="color: #f8f8f2">[</span><span style="color: #f92672">...</span><span style="color: #f8f8f2">]</span>

        <span style="color: #75715e"># If client is requesting only the size of the field, we return it instead</span>
        <span style="color: #75715e"># of the content. Presumably a separate request will be done to read the actual</span>
        <span style="color: #75715e"># content if it&#39;s needed at some point.</span>
        <span style="color: #75715e"># TODO: after 6.0 we should consider returning a dict with size and content instead of</span>
        <span style="color: #75715e">#       having an implicit convention for the value</span>
        <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">val</span> <span style="color: #f92672">and</span> <span style="color: #f8f8f2">context</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">get(</span><span style="color: #e6db74">&#39;bin_size_%s&#39;</span> <span style="color: #f92672">%</span> <span style="color: #f8f8f2">name,</span> <span style="color: #f8f8f2">context</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">get(</span><span style="color: #e6db74">&#39;bin_size&#39;</span><span style="color: #f8f8f2">)):</span>
            <span style="color: #f8f8f2">res[i]</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">tools</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">human_size(long(val))</span>
        <span style="color: #f8f8f2">[</span><span style="color: #f92672">...</span><span style="color: #f8f8f2">]</span>
</pre></div>


<p>After some research I figured out that it is possible to overwrite this
immutable <code>context</code> with the method <code>with_context</code> on the model itself.</p>

<p><a href="http://odoo-new-api-guide-line.readthedocs.org/en/latest/environment.html#modifing-environment">http://odoo-new-api-guide-line.readthedocs.org/en/latest/environment.html#modifing-environment</a></p>

<p>So the final version of my <code>_get_image</code> method looked like this:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">class</span> <span style="color: #a6e22e">MyModel</span><span style="color: #f8f8f2">(models</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Model):</span>
    <span style="color: #f8f8f2">_name</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;my.model&#39;</span>

    <span style="color: #f8f8f2">[</span><span style="color: #f92672">...</span><span style="color: #f8f8f2">]</span>

    <span style="color: #a6e22e">@api.one</span>
    <span style="color: #a6e22e">@api.depends</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;image&quot;</span><span style="color: #f8f8f2">)</span>
    <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">_get_image</span><span style="color: #f8f8f2">(self):</span>
        <span style="color: #e6db74">&quot;&quot;&quot; calculate the images sizes and set the images to the corresponding</span>
<span style="color: #e6db74">            fields</span>
<span style="color: #e6db74">        &quot;&quot;&quot;</span>
        <span style="color: #f8f8f2">image</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">image</span>

        <span style="color: #75715e"># check if the context contains the magic `bin_size` key</span>
        <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">env</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">context</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">get(</span><span style="color: #e6db74">&quot;bin_size&quot;</span><span style="color: #f8f8f2">):</span>
            <span style="color: #75715e"># refetch the image with a clean context</span>
            <span style="color: #f8f8f2">image</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">env[self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">_name]</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">with_context({})</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">browse(self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">id)</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">image</span>

        <span style="color: #f8f8f2">data</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">tools</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">image_get_resized_images(image)</span>
        <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">image_medium</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">data[</span><span style="color: #e6db74">&quot;image_medium&quot;</span><span style="color: #f8f8f2">]</span>
        <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">image_small</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">data[</span><span style="color: #e6db74">&quot;image_small&quot;</span><span style="color: #f8f8f2">]</span>
        <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">True</span>
</pre></div>


<p>Now it was possible to access the computed fields directly with the URL of the
<code>website</code> controller:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">&lt;</span><span style="color: #f92672">img</span> <span style="color: #a6e22e">t-attf-src</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;/website/image/my.model/{{ my.model.id }}/image_small&quot;</span> <span style="color: #f8f8f2">/&gt;</span>
</pre></div>


<p>Or simply by the URL itself:</p>

<p><a href="http://localhost:8069/website/image/my.model/1/image_medium">http://localhost:8069/website/image/my.model/1/image_medium</a></p>

<h2 id="conclusion">Conclusion</h2>

<p>The size calculation of the images takes some time and this should be
considered with regard to the servers performance. So I guess it makes
more sense to actually store the image scales in the database to avoid
this workaround described above.</p>

<p>I also think that the workaround bypasses security, since it removes the <code>uid</code>
from the context as well. But I didn&rsquo;t investigate it any further.</p>

<p>The whole excursion was more or less driven by curiosity, since I only found
instructions in the internet on how to do this using the old Odoo V7 API.</p>

<p>The closest tutorial I found was this here:</p>

<p><a href="http://www.odoo.yenthevg.com/saving-and-resizing-images-in-odoo-8">http://www.odoo.yenthevg.com/saving-and-resizing-images-in-odoo-8</a></p>

<p>So I hope this is useful for someone:)</p>

<div class="container rb-divider">
  <div class="row">
    <div class="dividewhite2"></div>
    <div class="e-block-centered">
      &mdash; <img src="/img/rb_logo_32x32.png" /> &mdash;
    </div>
    <div class="dividewhite2"></div>
  </div>
</div>


            
            
<div class="widget">
  <div class="widget_facebook">
    <h4 class="font-accident-one-bold uppercase"></h4>

    <div class="fb-page"
         data-href="https://www.facebook.com/ridingbytes"
         data-small-header="true"
         data-hide-cta="true"
         data-adapt-container-width="true"
         data-hide-cover="true"
         data-show-facepile="false">
      <div class="fb-xfbml-parse-ignore">
        <blockquote cite="https://www.facebook.com/ridingbytes">
          <a href="https://www.facebook.com/ridingbytes">RIDING BYTES</a>
        </blockquote>
      </div>
    </div>

    <div id="fb-root"></div>
    <script>(function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/de_DE/sdk.js#xfbml=1&version=v2.5";
      fjs.parentNode.insertBefore(js, fjs);
      }(document, 'script', 'facebook-jssdk'));
    </script>

  </div>
</div>


            
          </div>
        </div>

        <div class="row">
          <div class="col-md-12 post-content">
            
            <div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'ridingbytes';

    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


            
          </div>
        </div>
      </div>

    </div>
    

    
    <a class="gm-toggle-link">
      <div class="gm-toggle">
        <i class="fa fa-map-marker"></i>
      </div>
    </a>
    <div id="gm-panel">
        <div id="google-map" class="bigmap"></div>
    </div>
    

    
    <div id="footer">
      
      <div class="container">

  <div class="row">

    
    <div class="col-sm-3">
      
<div class="infoblock">
  <h2 class="font-accident-one-bold">Riding Bytes</h2>

  
  <p class=" ">RIDING BYTES is a web development company, which is specialized in UI/UX design, server based solutions and consulting services.</p>
  
  <p class=" ">With over 10 years of experience in web development and consulting, we provide the right solutions for small, medium and large enterprises.</p>
  

</div>


    </div>

    
    <div class="col-sm-3">
      
<div class="infoblock">
  <h2 class="font-accident-one-bold">Contact</h2>

  
  <div class="contact">

    
    
    <div class="footer-addr">
      <div class="footer-icon"><i class="fa fa-home"></i></div>
      <div class="addr-text">RIDING BYTES UG (haftungsbeschränkt), Einöde 49A, 87474 Buchenberg, Germany</div>
    </div>
    

    
    
    <div class="dividewhite1"></div>
    <div class="footer-addr">
      <div class="footer-icon"><i class="fa fa-phone"></i></div>
      <div class="addr-text"><a href="tel:&#43;49%20%280%29%208378%209321463">&#43;49 (0) 8378 9321463</a></div>
    </div>
    

    
    
    <div class="dividewhite1"></div>
    <div class="footer-addr">
      <div class="footer-icon"><i class="fa fa-link"></i></div>
      <div class="addr-text"><a href="http://ridingbytes.com">http://ridingbytes.com</a></div>
    </div>
    

    
    
    <div class="dividewhite1"></div>
    <div class="footer-addr">
      <div class="footer-icon"><i class="fa fa-envelope"></i></div>
      <div class="addr-text"><a href="mailto:hello@ridingbytes.com">hello@ridingbytes.com</a></div>
    </div>
    

  </div>
  

</div>


    </div>
    

    
    <div class="col-sm-3">
      
  <div class="infoblock">
    <h2 class="font-accident-one-bold">Impressions</h2>
    <ul id="basicuse" class="thumbs"></ul>
  </div>


    </div>
    

    
    <div class="col-sm-3">
      
<div class="infoblock">
  
  <h2 class="font-accident-one-bold"> Follow us </h2>
  <div class="follow">

    
    <div class="follow-element">
      <div class="follow-icon"><i class="fa fa-facebook"></i></div>
      <div class="follow-descr">
        <div class="follow-social"><a href="https://www.facebook.com/ridingbytes">Facebook</a></div>
        
      </div>
    </div>
    <div class="dividewhite1"></div>
    
    <div class="follow-element">
      <div class="follow-icon"><i class="fa fa-github"></i></div>
      <div class="follow-descr">
        <div class="follow-social"><a href="https://github.com/ridingbytes">GitHub</a></div>
        
      </div>
    </div>
    <div class="dividewhite1"></div>
    
    <div class="follow-element">
      <div class="follow-icon"><i class="fa fa-linkedin"></i></div>
      <div class="follow-descr">
        <div class="follow-social"><a href="https://www.linkedin.com/company/riding-bytes">LinkedIn</a></div>
        
      </div>
    </div>
    <div class="dividewhite1"></div>
    
    <div class="follow-element">
      <div class="follow-icon"><i class="fa fa-twitter"></i></div>
      <div class="follow-descr">
        <div class="follow-social"><a href="https://twitter.com/ridingbytes">Twitter</a></div>
        
      </div>
    </div>
    <div class="dividewhite1"></div>
    

  </div>
</div>


    </div>
    

  </div>
</div>


      
      <div id="copyrights-wrapper">
  <div class="container">
    <div class="copyright">
      <div class="copy-attrs">
        &copy; 2015-2017
        <a href="/" target="_blank">RIDING BYTES</a>. All rights reserved
      </div>

      
      <div class="copy-link">
        <a href="/legal">Legal Notice</a>
      </div>
      

      
      






















<img src="https://piwik.ridingbytes.com/piwik.php?idsite=1&rec=1" style="border:0" alt="" />


      

    </div>
  </div>
</div>

    </div>
    

    
    <div id="back-top"><a href="#top"></a></div>
    

  </body>
</html>
